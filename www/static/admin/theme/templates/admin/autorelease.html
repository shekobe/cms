<!DOCTYPE html>
<!-- 
Template Name: Metronic - Responsive Admin Dashboard Template build with Twitter Bootstrap 3.3.4
Version: 3.9.0
Author: KeenThemes
Website: http://www.keenthemes.com/
Contact: support@keenthemes.com
Follow: www.twitter.com/keenthemes
Like: www.facebook.com/keenthemes
Purchase: http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes
License: You must have a valid license purchased only from themeforest(the above link) in order to legally use the theme for your project.
-->
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
	<!--<![endif]-->
	<!-- BEGIN HEAD -->
	<head>
		<meta charset="utf-8"/>
		<title>Metronic | Data Tables - Editable Datatables</title>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<meta content="" name="description"/>
		<meta content="" name="author"/>
		<!-- BEGIN GLOBAL MANDATORY STYLES -->
		<!--<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all" rel="stylesheet" type="text/css"/>-->
		<link href="../../assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
		<link href="../../assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css"/>
		<link href="../../assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
		<link href="../../assets/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css"/>
		<link href="../../assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css"/>
		<!-- END GLOBAL MANDATORY STYLES -->
		<!-- BEGIN PAGE LEVEL STYLES -->
		<link rel="stylesheet" type="text/css" href="../../assets/global/plugins/select2/select2.css"/>
		<link rel="stylesheet" type="text/css" href="../../assets/global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.css"/>
		<!-- END PAGE LEVEL STYLES -->
		<!-- BEGIN PAGE LEVEL STYLES -->
		<link href="../../assets/global/plugins/bootstrap-modal/css/bootstrap-modal-bs3patch.css" rel="stylesheet" type="text/css"/>
		<link href="../../assets/global/plugins/bootstrap-modal/css/bootstrap-modal.css" rel="stylesheet" type="text/css"/>
		<!-- END PAGE LEVEL STYLES -->
		<!-- BEGIN THEME STYLES -->
		<link href="../../assets/global/css/components.css" id="style_components" rel="stylesheet" type="text/css"/>
		<link href="../../assets/global/css/plugins.css" rel="stylesheet" type="text/css"/>
		<link href="../../assets/admin/layout/css/layout.css" rel="stylesheet" type="text/css"/>
		<link id="style_color" href="../../assets/admin/layout/css/themes/darkblue.css" rel="stylesheet" type="text/css"/>
		<link href="../../assets/admin/layout/css/custom.css" rel="stylesheet" type="text/css"/>
		<!-- END THEME STYLES -->
		<link rel="shortcut icon" href="favicon.ico"/>
		<script src="../../assets/admin/layout/scripts/socket.io.js"></script>
	</head>
	<!-- END HEAD -->
	<!-- BEGIN BODY -->
	<!-- DOC: Apply "page-header-fixed-mobile" and "page-footer-fixed-mobile" class to body element to force fixed header or footer in mobile devices -->
	<!-- DOC: Apply "page-sidebar-closed" class to the body and "page-sidebar-menu-closed" class to the sidebar menu element to hide the sidebar by default -->
	<!-- DOC: Apply "page-sidebar-hide" class to the body to make the sidebar completely hidden on toggle -->
	<!-- DOC: Apply "page-sidebar-closed-hide-logo" class to the body element to make the logo hidden on sidebar toggle -->
	<!-- DOC: Apply "page-sidebar-hide" class to body element to completely hide the sidebar on sidebar toggle -->
	<!-- DOC: Apply "page-sidebar-fixed" class to have fixed sidebar -->
	<!-- DOC: Apply "page-footer-fixed" class to the body element to have fixed footer -->
	<!-- DOC: Apply "page-sidebar-reversed" class to put the sidebar on the right side -->
	<!-- DOC: Apply "page-full-width" class to the body element to have full width page without the sidebar menu -->
	<body class="page-header-fixed page-quick-sidebar-over-content " style="background-color: #fff;" >

		<div class="clearfix">
		</div>
		<!-- BEGIN CONTAINER -->
		<div class="">

			<!-- BEGIN CONTENT -->
			<div class="page-content-wrapper">
				<div >
					<!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
					<div class="modal fade" id="portlet-config" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
									<h4 class="modal-title">Modal title</h4>
								</div>
								<div class="modal-body">
									Widget settings form goes here
								</div>
								<div class="modal-footer">
									<button type="button" class="btn blue">Save changes</button>
									<button type="button" class="btn default" data-dismiss="modal">Close</button>
								</div>
							</div>
							<!-- /.modal-content -->
						</div>
						<!-- /.modal-dialog -->
					</div>
					<!-- /.modal -->
					<!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->


					<!-- BEGIN PAGE CONTENT-->
					<div class="row">
						<div class="col-md-12">
							<!-- BEGIN EXAMPLE TABLE PORTLET-->
							<div class="portlet box blue">
								<div class="portlet-title">
									<div class="caption">
										<i class="fa fa-edit"></i>服务器设置
									</div>

								</div>
								<div class="portlet-body">
									<div class="table-toolbar">
										<div class="row">
											<div class="col-md-6">
												<div class="btn-group">
													<button id="sample_editable_1_new" class="btn green">
														新增 <i class="fa fa-plus"></i>
													</button>
												</div>
											</div>

										</div>
									</div>
									<table class="table j_contentBox table-striped table-hover table-bordered" id="sample_editable_1">

									</table>
								</div>
							</div>
							<!-- END EXAMPLE TABLE PORTLET-->
						</div>
					</div>
					<!-- END PAGE CONTENT -->

					<div class="row">
						<div class="col-md-12">
							<!-- BEGIN EXAMPLE TABLE PORTLET-->
							<div class="portlet box yellow">
								<div class="portlet-title">
									<div class="caption">
										<i class="fa fa-edit"></i>服务器执行脚本设置
									</div>

								</div>
								<div class="portlet-body">


									<div class="table-toolbar">
										<div class="row">
											<div class="col-md-6">
												<div class="btn-group">

													<a data-toggle="modal" href="#responsive" id="sample_editable_2_new" class="btn green">
														新增 <i class="fa fa-plus"></i>
													</a>
												</div>


											</div>

										</div>

									</div>
									<table class="table j_contentBox2 table-striped table-hover table-bordered" id="sample_editable_2">

									</table>
									<div id="responsive" class="modal fade" tabindex="-1" data-width="760">
										<div class="modal-header">
											<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
											<h4 class="modal-title">新增脚本文件</h4>
										</div>
										<form id="uploadform" action="/admin/server/addscript" enctype="multipart/form-data" method="post">
										<div class="modal-body">
											<div class="row">
												<div class="col-md-12">


														<input class="j_file" type="file" name="image" />


													<h4>脚本说明</h4>
													<p>
														<input class="form-control j_name" name="name" type="text">
													</p>

												</div>

											</div>
										</div>
										<div class="modal-footer">
											<button type="button" data-dismiss="modal" class="btn j_cancel btn-default">取消</button>
											<button type="submit" class="btn j_uploadSubmit blue">保存</button>
										</div>
										</form>
									</div>
								</div>
							</div>
							<!-- END EXAMPLE TABLE PORTLET-->
						</div>
					</div>

					<div class="row">
						<div class="col-md-12">
							<!-- BEGIN EXAMPLE TABLE PORTLET-->
							<div class="portlet box red">
								<div class="portlet-title">
									<div class="caption">
										<i class="fa fa-edit"></i>命令设置
									</div>

								</div>
								<div class="portlet-body">


									<div class="table-toolbar">
										<div class="row">
											<div class="col-md-6">
												<div class="btn-group">

													<a data-toggle="modal" href="#responsive2" id="" class="btn j_responsive2 green">
														新增 <i class="fa fa-plus"></i>
													</a>

													<!--<a href=".retest" data-toggle="modal" class="btn  j_test red">-->
														<!--测试执行命令 <i class="fa fa-plus"></i>-->
													<!--</a>-->
												</div>


											</div>


										</div>

									</div>
									<div class="row">


										<div class="col-md-12">
											<div class="tab-content j_contentBox5">


											</div>
										</div>
										<div class="modal retest fade" tabindex="-1" data-width="760">
											<div class="modal-header">
												<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
												<h4 class="modal-title">执行命令</h4>
											</div>
											<div class="modal-body" style="background-color: rgb(29, 29, 29);color: rgb(255, 255, 255);">
												<div class="row">

													<div class="col-md-12">
														<ul style="height: 500px;margin: 0;overflow-y: scroll;padding: 10px 20px 10px 20px;" class="messages">
															<li class="message">
																<span class="messageBody">sdfsdfds</span>
															</li>
															<li class="message">
																<span class="messageBody">sdfsdfds</span>
															</li>
															<li class="message">
																<span class="messageBody">sdfsdfds</span>
															</li>
															<li class="message">
																<span class="messageBody">sdfsdfds</span>
															</li>
															<li class="message">
																<span class="messageBody">sdfsdfds</span>
															</li>
															<li class="message">
																<span class="messageBody">sdfsdfds</span>
															</li><li class="message">
															<span class="messageBody">sdfsdfds</span>
														</li><li class="message">
															<span class="messageBody">sdfsdfds</span>
														</li><li class="message">
															<span class="messageBody">sdfsdfds</span>
														</li>
															<li class="message">
																<span class="messageBody">sdfsdfds</span>
															</li>



															<li class="message">
																<span class="messageBody">sdfsdfds</span>
															</li>
														</ul>

													</div>
												</div>
											</div>
											<div class="modal-footer">
												<button type="button" data-dismiss="modal" class="btn btn-default">Close</button>
												<!--<button type="button" class="btn blue">Save changes</button>-->
											</div>
										</div>
									</div>


									<div id="responsive2" class="modal fade" tabindex="-1" data-width="760">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
										<h4 class="modal-title">新增命令</h4>
									</div>

									<div class="modal-body">
										<form id="orderForm" action="">
											<div class="row">
												<div class="col-md-12">
													<h4>名称</h4>
													<input type="text" name="name" class="form-control text" placeholder="Enter text">

												</div>
												<div class="col-md-12">
													<h4>选择执行脚本</h4>
													<div style="margin-left: 20px;" class="radio-list j_contentBox3">


													</div>

												</div>

												<div class="col-md-12">
													<h4>选择服务器</h4>
													<div style="margin-left: 20px;" class="checkbox-list j_contentBox4">

													</div>
												</div>

											</div>
										</form>
									</div>
									<div class="modal-footer">
										<button type="button" data-dismiss="modal" class="btn btn-default">取消</button>
										<button type="submit" class="btn j_orderSubmit blue">保存</button>
									</div>

								</div>
									<div id="responsive2_edit" class="modal fade" tabindex="-1" data-width="760">
										<div class="modal-header">
											<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
											<h4 class="modal-title">修改命令</h4>
										</div>

										<div class="modal-body">
											<form id="orderForm_edit" action="">
												<div class="row">
													<div class="col-md-12">
														<h4>名称</h4>

														<input type="text" name="name" class="form-control text" placeholder="Enter text">

													</div>
													<div class="col-md-12">
														<h4>选择执行脚本</h4>
														<div style="margin-left: 20px;" class="radio-list j_contentBox3_edit">


														</div>

													</div>

													<div class="col-md-12">
														<h4>选择服务器</h4>
														<div style="margin-left: 20px;" class="checkbox-list j_contentBox4_edit">

														</div>
													</div>

												</div>
											</form>
										</div>
										<div class="modal-footer">
											<button type="button" data-dismiss="modal" class="btn btn-default">取消</button>
											<button type="submit" class="btn j_orderSubmit_edit blue">保存</button>
										</div>

									</div>
								</div>
							</div>
							<!-- END EXAMPLE TABLE PORTLET-->
						</div>
					</div>

				</div>
			</div>
			<!-- END CONTENT -->

		</div>
		<!-- END CONTAINER -->
		<!-- BEGIN FOOTER -->

		<script id="userlist2" type="text/html">
			<thead>
			<tr>
				<th>
					脚本说明
				</th>
				<th>
					修改
				</th>
				<th>
					删除
				</th>
			</tr>
			</thead>
			<tbody>
			{{each data as value i}}
			<tr data-id="{{value._id}}" data-path="{{value.path}}">
				<td>
					{{value.name}}
				</td>

				<td>
					<form action="/admin/server/updatescript" enctype="multipart/form-data" method="post">
						<input type="file" name="image" />
						<input type="hidden" value="{{value.path}}" name="name"/>
						<input type="submit" class="j_updataSubmint" value="修改"/>
					</form>

				</td>
				<td>
					<a data-id="{{value._id}}" class="j_sdelete btn default red" href="javascript:;">
						删除 </a>
				</td>
			</tr>
			{{/each}}
			</tbody>



		</script>
		<script id="userlist3" type="text/html">
			{{each data as value i}}
			<label class="radio-inline">
				<input type="radio" name="optionsRadios" value="{{value.path}}">{{value.name}} </label>

			{{/each}}




		</script>
		<script id="userlist4" type="text/html">
			{{each data as value i}}

			<label class="checkbox-inline">

				<input name="cbox" type="checkbox" data-group="{{value.group}}" data-pass="{{value.pass}}" data-user="{{value.user}}" value="{{value.ip}}">{{value.ip}} </label>
			{{/each}}




		</script>
		<script id="userlist" type="text/html">
			<thead>
			<tr>
				<th>
					IP地址
				</th>
				<th>
					端口
				</th>
				<th>
					用户名
				</th>
				<th>
					密码
				</th>
				<th>
					组
				</th>
				<th>
					修改
				</th>
				<th>
					删除
				</th>
			</tr>
			</thead>
			<tbody>
			{{each data as value i}}
			<tr data-id="{{value._id}}">
				<td>
					{{value.ip}}
				</td>
				<td>
					{{value.port}}
				</td>
				<td>
					{{value.user}}
				</td>
				<td class="center">
					******
				</td>
				<td>
					{{value.group}}
				</td>
				<td>
					<a data-id="{{value._id}}" class="edit btn default green" href="javascript:;">
						修改 </a>
				</td>
				<td>
					<a data-id="{{value._id}}" class="delete btn default red" href="javascript:;">
						删除 </a>
				</td>
			</tr>
			{{/each}}
			</tbody>



		</script>
		<script id="userlist5" type="text/html">
			{{if data.length == 0}}
			暂无更新数据。
			{{/if}}
			{{each data as value i}}
			<div id="tab_{{i}}" class="tab-pane active">
				<div id="accordion{{i}}" class="panel-group">


					<div class="panel panel-default">

							<div class="panel-heading" data-toggle="collapse" data-parent="#accordion{{i}}" href="#accordion1_{{i}}" aria-expanded="false">
								<h4 style="width: 830px;color: #000;" class="panel-title">
									{{i+1}}、{{value.name}}

									<div style="float: right">

										<a href=".retest" data-name="{{value.name}}" data-toggle="modal" class="j_test btn btn-danger" data-user="{{value.userArr}}" data-pass="{{value.passArr}}" data-group="{{value.groupArr}}"  data-id="{{value._id}}" data-server="{{value.serverArr}}" data-script="{{value.scriptPath}}">执行命令</a>

										<a href="#responsive2_edit" data-toggle="modal" class=" j_edit btn default blue" data-scriptpath="{{value.scriptPath}}" data-serverarr="{{value.serverArr}}" data-id="{{value._id}}" data-name="{{value.name}}">修改</a>

										<a class="j_del btn default red" data-id="{{value._id}}">删除</a>
									</div>

								</h4>
								<div>
								<span style="color:#26a69a">
{{value.time}}
								</span>
								</div>
							</div>
							<div id="accordion1_{{i}}" class="panel-collapse collapse" aria-expanded="false" style="height: 0px;">
								<div class="panel-body">
									{{value.serverArr | dateFormatCon}}
								</div>
							</div>
						</div>

					</div>
				</div>
				{{/each}}

		</script>
		<!-- END FOOTER -->
		<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
		<!-- BEGIN CORE PLUGINS -->
		<!--[if lt IE 9]>
		<script src="../../assets/global/plugins/respond.min.js"></script>
		<script src="../../assets/global/plugins/excanvas.min.js"></script>
		<![endif]-->
		<script src="../../assets/global/plugins/jquery.min.js" type="text/javascript"></script>
		<script src="../../assets/global/plugins/jquery-migrate.min.js" type="text/javascript"></script>
		<!-- IMPORTANT! Load jquery-ui.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
		<script src="../../assets/global/plugins/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
		<script src="../../assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
		<script src="../../assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
		<script src="../../assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
		<script src="../../assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
		<script src="../../assets/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
		<script src="../../assets/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
		<script src="../../assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
		<!-- END CORE PLUGINS -->
		<!-- BEGIN PAGE LEVEL PLUGINS -->
		<script src="../../assets/global/plugins/bootstrap-modal/js/bootstrap-modalmanager.js" type="text/javascript"></script>
		<script src="../../assets/global/plugins/bootstrap-modal/js/bootstrap-modal.js" type="text/javascript"></script>
		<!-- END PAGE LEVEL PLUGINS -->
		<!-- BEGIN PAGE LEVEL PLUGINS -->
		<script type="text/javascript" src="../../assets/global/plugins/select2/select2.min.js"></script>
		<script type="text/javascript" src="../../assets/global/plugins/datatables/media/js/jquery.dataTables.min.js"></script>
		<script type="text/javascript" src="../../assets/global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.js"></script>
		<!-- END PAGE LEVEL PLUGINS -->
		<!-- BEGIN PAGE LEVEL PLUGINS -->
		<script src="../../assets/global/plugins/bootstrap-modal/js/bootstrap-modalmanager.js" type="text/javascript"></script>
		<script src="../../assets/global/plugins/bootstrap-modal/js/bootstrap-modal.js" type="text/javascript"></script>
		<!-- END PAGE LEVEL PLUGINS -->
		<!-- BEGIN PAGE LEVEL SCRIPTS -->
		<script src="../../assets/global/scripts/metronic.js" type="text/javascript"></script>
		<script src="../../assets/admin/layout/scripts/layout.js" type="text/javascript"></script>
		<script src="../../assets/admin/layout/scripts/quick-sidebar.js" type="text/javascript"></script>
		<script src="../../assets/admin/layout/scripts/demo.js" type="text/javascript"></script>
		<script src="../../assets/admin/layout/scripts/template.js"></script>
		<script src="../../assets/admin/pages/scripts/table-editable_auto.js"></script>
		<script src="../../assets/admin/pages/scripts/ui-extended-modals.js"></script>
		<script src="../../assets/global/scripts/jquery.form.js"></script>
		<script>
			jQuery(document).ready(function() {
//				Metronic.init(); // init metronic core components
//				Layout.init(); // init current layout
//				QuickSidebar.init(); // init quick sidebar
//				Demo.init(); // init demo features
				var $window = $(window);
				var $messages = $('.messages'); // Messages area
				var socket = io();
				template.helper('dateFormatCon', function (str,from) {


					var arr = str.split(',');
					var str2 = '';
					for(var i=0;i<arr.length;i++){
						str2 +='<div class="path">'+arr[i]+'</div>';
					}
					return str2;


				});
				initData();
				function initData(){//getuserbyname
					$.ajax({
						url:'/admin/server/getserverlist',
						type:'POST',
						cache: false,
						complete:function(xhr, textStatus){
							if(textStatus == 'success' && xhr.status == '200'){
								var response = eval("("+xhr.responseText+")");
								window.console && console.log('getuserlist get data',response);
								if(response.errno == 0){//返回数据正常
									window.console && console.log('do updateall');
									var str = template('userlist',response);
									$('.j_contentBox').html(str);
									TableEditable.init();
								}else{

								}

							}else{
								window.console && console.log('error',xhr, textStatus);
							}
						}
					});

				}
				setTimeout(function(){
					initData2();
				},400);
				setTimeout(function(){
					initData3();
				},800);
				function initData3(){//getuserbyname
					$.ajax({
						url:'/admin/server/getscriptorderlist',
						type:'POST',
						cache: false,
						complete:function(xhr, textStatus){
							if(textStatus == 'success' && xhr.status == '200'){
								var response = eval("("+xhr.responseText+")");
								if(response.errno == 0){//返回数据正常
									var str = template('userlist5',response);
									$('.j_contentBox5').html(str);
								}else{

								}

							}else{
								window.console && console.log('error',xhr, textStatus);
							}
						}
					});

				}
				function initData2(){//getuserbyname
					$.ajax({
						url:'/admin/server/getscriptlist',
						type:'POST',
						cache: false,
						complete:function(xhr, textStatus){
							if(textStatus == 'success' && xhr.status == '200'){
								var response = eval("("+xhr.responseText+")");
								window.console && console.log('getuserlist get data',response);
								if(response.errno == 0){//返回数据正常
									window.console && console.log('do updateall');
									var str = template('userlist2',response);
									$('.j_contentBox2').html(str);
								}else{

								}

							}else{
								window.console && console.log('error',xhr, textStatus);
							}
						}
					});

				}
				$(document).on('click','.j_sdelete',function(){
					if (confirm("确定要删除吗 ?") == false) {
						return;
					}
					var id = $(this).attr('data-id');
					window.console && console.log('id',id);
					$.ajax({
						url:'/admin/server/delscriptbyid',
						type:'POST',
						cache: false,
						data:{
							id:id
						},
						complete:function(xhr, textStatus){
							if(textStatus == 'success' && xhr.status == '200'){
								var response = eval("("+xhr.responseText+")");
								window.console && console.log('deluserbyid get data',response);
								if(response.errno == 0){//返回数据正常
									initData2();

								}else{

								}

							}else{
								window.console && console.log('error',xhr, textStatus);
							}
						}
					});
				});

				$(document).on('click','.j_del',function(e){
					e.stopPropagation();
					if (confirm("确定要删除吗 ?") == false) {
						return;
					}
					var id = $(this).attr('data-id');
					window.console && console.log('id',id);
					$.ajax({
						url:'/admin/server/delscriptorderbyid',
						type:'POST',
						cache: false,
						data:{
							id:id
						},
						complete:function(xhr, textStatus){
							if(textStatus == 'success' && xhr.status == '200'){
								var response = eval("("+xhr.responseText+")");
								window.console && console.log('deluserbyid get data',response);
								if(response.errno == 0){//返回数据正常
									initData3();

								}else{

								}

							}else{
								window.console && console.log('error',xhr, textStatus);
							}
						}
					});
				});
				//增加数据
				$('.j_uploadSubmit').on('click',function(e){
					if(!$('#uploadform').find('.j_name').val()){
						e.preventDefault();
						alert('请填写脚本说明');
						return;
					}
					$('#uploadform').ajaxForm({
						beforeSend: function() {
							window.console && console.log('uploadform');
						},
						uploadProgress: function(event, position, total, percentComplete) {

						},
						success: function() {

						},
						complete: function(xhr) {
							window.console && console.log(xhr.responseText);
							var response = eval("("+xhr.responseText+")");

							if(response.errno == 0){//返回数据正常
								$('#uploadform').find('.j_cancel').trigger('click');
								var str = template('userlist2',response);
								$('.j_contentBox2').html(str);

							}else{

							}

						}
					});

				});


				$(document).on('click','.j_test',function(e){
					$('div.retest').find('.modal-title').html('执行'+$(this).attr('data-name')+'命令');
					var serverpath = $(this).attr('data-server').split(',');
					var scriptPath = $(this).attr('data-script');
					var userArr = $(this).attr('data-user').split(',');
					var passArr = $(this).attr('data-pass').split(',');
					var groupArr = $(this).attr('data-group').split(',');
              window.console && console.log('123456');
					e.stopPropagation();
					$messages.empty();
					setTimeout(function(){
						socket.emit('execserver',{
							scriptPath:scriptPath,
							ipArr:serverpath,
							userArr:userArr,
							passArr:passArr,
							groupArr:groupArr
						});

					},600);
				});
				socket.on('abc', function (data) {
					//window.console && console.log('get socket message',data.message);
					setCon(data.message)
				});
				function setCon(data) {
					var $messageBodyDiv = $('<span class="messageBody">')
							.html(data);
					var $messageDiv = $('<li class="message"/>')
							.append($messageBodyDiv);
					var $el = $($messageDiv);
					$messages.append($el);
					$messages[0].scrollTop = $messages[0].scrollHeight;
				}
				$(document).on('click','.j_responsive2',function(e){
					window.console && console.log('增加命令');
					$('#responsive2').find('input[name="name"]').val('');
					$.ajax({
						url:'/admin/server/getscriptlist',
						type:'POST',
						cache: false,
						complete:function(xhr, textStatus){
							if(textStatus == 'success' && xhr.status == '200'){
								var response = eval("("+xhr.responseText+")");
								window.console && console.log('userlist3',response);
								if(response.errno == 0){//返回数据正常
									var str = template('userlist3',response);
									$('.j_contentBox3').html(str);

								}else{

								}

							}else{
								window.console && console.log('error',xhr, textStatus);
							}
						}
					});
					setTimeout(function(){
						$.ajax({
							url:'/admin/server/getserverlist',
							type:'POST',
							cache: false,
							complete:function(xhr, textStatus){
								if(textStatus == 'success' && xhr.status == '200'){
									var response = eval("("+xhr.responseText+")");
									window.console && console.log('userlist4',response);
									if(response.errno == 0){//返回数据正常
										var str = template('userlist4',response);
										$('.j_contentBox4').html(str);
										$('.j_contentBox4').find('input[name="cbox"]').each(function(){
											var s = $(this);
											s.attr('checked',true);

										});

									}else{

									}

								}else{
									window.console && console.log('error',xhr, textStatus);
								}
							}
						});
					},400);

				});
				$(document).on('click','.j_updataSubmint',function(e){
					var t = $(this);
					t.closest('form').ajaxForm({
						beforeSend: function() {
							window.console && console.log('uploadform');
						},
						uploadProgress: function(event, position, total, percentComplete) {

						},
						success: function() {

						},
						complete: function(xhr) {
							window.console && console.log(xhr.responseText);
							var response = eval("("+xhr.responseText+")");

							if(response.errno == 0){//返回数据正常
								alert('修改成功');
							}else{

							}

						}
					});

				});
				//新增命令
				$(document).on('click','.j_orderSubmit',function(e){
					var t = $(this);
					var $div = $('#responsive2');
window.console && console.log($('.j_contentBox4').find('input[type="checkbox"]:checked').length);
					if(!$div.find('input.text').val() || !$('.j_contentBox4').find('input[type="checkbox"]:checked').length || !$('.j_contentBox3').find('input[name="optionsRadios"]:checked').length){
						alert('请完善选项');
						return;
					}
					var sarr = $('#orderForm').serializeArray();
window.console && console.log('sarr',sarr);
					window.console && console.log('name',sarr[0].value);
					window.console && console.log('scriptArr',sarr[1].value);
					var serverArr = [],
							userArr = [],
							passArr = [],
							groupArr = [];
					$div.find('.j_contentBox4').find('input[type="checkbox"]:checked').each(function(){
						var t = $(this);
						serverArr.push(t.val());
						userArr.push(t.attr('data-user'));
						passArr.push(t.attr('data-pass'));
						groupArr.push(t.attr('data-group'));

					});
//					var temparr = [];
//					for(var i=2;i<sarr.length;i++){
//						temparr.push(sarr[i].value);
//					}
					$.ajax({
						url:'/admin/server/addserverorder',
						type:'POST',
						cache: false,
						data:{
							name:sarr[0].value,
							scriptPath:sarr[1].value,
							serverArr:serverArr.toString(),
							userArr:userArr.toString(),
							passArr:passArr.toString(),
							groupArr:groupArr.toString()

						},
						complete:function(xhr, textStatus){
							if(textStatus == 'success' && xhr.status == '200'){
								var response = eval("("+xhr.responseText+")");
								window.console && console.log('get data',response);
								if(response.errno == 0){//返回数据正常
									t.siblings('button').trigger('click');
									 initData3();
								}else{
alert('增加失败');
								}

							}else{
								window.console && console.log('error',xhr, textStatus);
							}
						}
					});


				});

				$(document).on('click','.j_orderSubmit_edit',function(e){
					var t = $(this);
					var $div = $('#responsive2_edit');
					window.console && console.log($('.j_contentBox4_edit').find('input[type="checkbox"]:checked').length);
					if(!$div.find('input.text').val() || !$('.j_contentBox4_edit').find('input[type="checkbox"]:checked').length || !$('.j_contentBox3_edit').find('input[name="optionsRadios"]:checked').length){
						alert('请完善选项');
						return;
					}
					var sarr = $('#orderForm_edit').serializeArray();

					window.console && console.log('name',sarr[0].value);
					window.console && console.log('scriptArr',sarr[1].value);
					var serverArr = [],
							userArr = [],
							passArr = [],
							groupArr = [];
					$div.find('.j_contentBox4_edit').find('input[type="checkbox"]:checked').each(function(){
						var t = $(this);
						serverArr.push(t.val());
						userArr.push(t.attr('data-user'));
						passArr.push(t.attr('data-pass'));
						groupArr.push(t.attr('data-group'));

					});

					$.ajax({
						url:'/admin/server/updateserverorderbyid',
						type:'POST',
						cache: false,
						data:{
							id:$('#orderForm_edit').attr('data-id'),
							name:sarr[0].value,
							scriptPath:sarr[1].value,
							serverArr:serverArr.toString(),
							userArr:userArr.toString(),
							passArr:passArr.toString(),
							groupArr:groupArr.toString()
						},
						complete:function(xhr, textStatus){
							if(textStatus == 'success' && xhr.status == '200'){
								var response = eval("("+xhr.responseText+")");
								window.console && console.log('get data',response);
								if(response.errno == 0){//返回数据正常
									t.siblings('button').trigger('click');
									initData3();
								}else{
									alert('增加失败');
								}

							}else{
								window.console && console.log('error',xhr, textStatus);
							}
						}
					});


				});
				//弹出修改命令
				$(document).on('click','.j_edit',function(e){
					e.stopPropagation();
					var t = $(this);
					$('#orderForm_edit').attr('data-id', t.attr('data-id'));
					var $div = $('#responsive2_edit');
					var name = t.attr('data-name');
					var scriptpath = t.attr('data-scriptpath');
					var serverarr = t.attr('data-serverarr').split(',');
					window.console && console.log('弹出修改命令',name,scriptpath,serverarr);
					$div.find('input[name="name"]').val(name);
					$.ajax({
						url:'/admin/server/getscriptlist',
						type:'POST',
						cache: false,
						complete:function(xhr, textStatus){
							if(textStatus == 'success' && xhr.status == '200'){
								var response = eval("("+xhr.responseText+")");
								window.console && console.log('userlist3',response);
								if(response.errno == 0){//返回数据正常
									var str = template('userlist3',response);
									$('.j_contentBox3_edit').html(str);
									$('.j_contentBox3_edit').find('input[name="optionsRadios"]').each(function(){
										var s = $(this);
										if(s.val() == scriptpath){
											s.attr('checked',true);
										}
									});

								}else{

								}

							}else{
								window.console && console.log('error',xhr, textStatus);
							}
						}
					});
					setTimeout(function(){
						$.ajax({
							url:'/admin/server/getserverlist',
							type:'POST',
							cache: false,
							complete:function(xhr, textStatus){
								if(textStatus == 'success' && xhr.status == '200'){
									var response = eval("("+xhr.responseText+")");
									window.console && console.log('userlist4',response);
									if(response.errno == 0){//返回数据正常
										var str = template('userlist4',response);
										$('.j_contentBox4_edit').html(str);
										$('.j_contentBox4_edit').find('input[name="cbox"]').each(function(){
											var s = $(this);
											for(var i=0 ;i<serverarr.length;i++){
												if(s.val() == serverarr[i]){
													s.attr('checked',true);
												}
											}

										});

									}else{

									}

								}else{
									window.console && console.log('error',xhr, textStatus);
								}
							}
						});
					},400);

				});

			});
		</script>
	</body>
	<!-- END BODY -->
</html>